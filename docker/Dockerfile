FROM ubuntu:18.04
MAINTAINER satwik.bhimavarapu@gmail.com

RUN echo "Hi google.com"

# Update the apt repo
RUN apt-get update -y
RUN apt-get upgrade -y

# Install basic dependencies
RUN apt-get install wget -y

# Installing python & dependencies
RUN apt-get install python python-pip python-dev libffi-dev libssl-dev -y
RUN apt-get install python-virtualenv python-setuptools -y
RUN apt-get install libjpeg-dev zlib1g-dev swig -y
RUN apt-get install mongodb -y

## TODO: Installing Virtual box
#RUN echo deb "http://download.virtualbox.org/virtualbox/debian xenial contrib | tee -a /etc/apt/sources.list.d/virtualbox.list"
#RUN wget -q "https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | apt-key add -"
#RUN apt-get update
#RUN apt-get install virtualbox-5.2

# Installing tcpdump
RUN apt-get install tcpdump apparmor-utils -y

# Installing Volatility
RUN apt-get update -y
RUN DEBIAN_FRONTEND=noninteractive apt-get install volatility -y

# Installing M2Crypto
RUN apt-get install libssl-dev swig python-dev gcc -y
RUN apt-get install swig -y
RUN pip install cryptography

# Installing guacd
RUN apt-get install libguac-client-rdp0 libguac-client-vnc0 libguac-client-ssh0 guacd -y

# Raising file limits
RUN echo "* \t hard \t nofile \t 500000\n* \t soft \t nofile \t 500000\nroot \t hard \t nofile \t 500000\nroot \t soft \t nofile \t500000\n" >> /etc/security/limits.conf
RUN echo "session required pam_limits.so" >> /etc/pam.d/common-session

RUN echo "fs.file-max = 2097152" >> /etc/sysctl.conf
RUN sysctl -p

# Install Cuckoo
RUN pip install -U pip setuptools
RUN pip install -U cuckoo

# Setup Cuckoo Working Directory - CWD
RUN mkdir /opt/cuckoo
RUN cuckoo --cwd /opt/cuckoo
RUN export CUCKOO=/opt/cuckoo

# TODO: Remove the below block
RUN which pip
RUN pip --version
RUN which python
RUN python --version

## Start the cuckoo deamon
#RUN cuckoo